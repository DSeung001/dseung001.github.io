{{- /* Comments area start */ -}}
{{- /* to add comments read => https://gohugo.io/content-management/comments/ */ -}}

{{- if (and site.Params.comments (ne .Params.disableComments true)) -}}
    <div class="comments">
        <div class="comments-header">
            <h3>ğŸ’¬ ëŒ“ê¸€</h3>
        </div>

        <script src="https://giscus.app/client.js"
                data-repo="DSeung001/dseung001.github.io"
                data-repo-id="R_kgDOO9ggNQ"
                data-category="Blog Comments"
                data-category-id="DIC_kwDOO9ggNc4CtfJF"
                data-mapping="pathname"
                data-strict="0"
                data-reactions-enabled="1"
                data-emit-metadata="0"
                data-input-position="top"
                data-theme="light"
                data-lang="ko"
                crossorigin="anonymous"
                async>
        </script>

        <!-- localStorage ê¸°ë°˜ ì™„ë²½í•œ í…Œë§ˆ ë™ê¸°í™” ìŠ¤í¬ë¦½íŠ¸ -->
        <script>
            // PaperMod í…Œë§ˆì™€ localStorage ë™ê¸°í™”ëœ í…Œë§ˆ ê°ì§€
            function getCurrentTheme() {
                // 1. localStorageì—ì„œ ì‚¬ìš©ì ì„ íƒ í™•ì¸ (PaperMod ìš°ì„ ìˆœìœ„)
                const userPreference = localStorage.getItem('pref-theme');
                
                if (userPreference === 'dark') {
                    return 'dark';
                } else if (userPreference === 'light') {
                    return 'light';
                }
                
                // 2. body í´ë˜ìŠ¤ í™•ì¸ (í˜„ì¬ ì ìš©ëœ ìƒíƒœ)
                if (document.body.classList.contains('dark')) {
                    return 'dark';
                }
                
                // 3. ì‹œìŠ¤í…œ ì„¤ì • í™•ì¸ (ê¸°ë³¸ê°’)
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    return 'dark';
                }
                
                // 4. ê¸°ë³¸ê°’
                return 'light';
            }

            // Giscus í…Œë§ˆ ì—…ë°ì´íŠ¸
            function updateGiscusTheme() {
                const currentTheme = getCurrentTheme();
                const giscusFrame = document.querySelector('iframe[src*="giscus.app"]');
                
                if (giscusFrame) {
                    try {
                        giscusFrame.contentWindow.postMessage({
                            giscus: {
                                setConfig: {
                                    theme: currentTheme
                                }
                            }
                        }, 'https://giscus.app');
                    } catch (error) {
                        // ì—ëŸ¬ ë¬´ì‹œ
                    }
                }
            }

            // localStorage ë³€ê²½ ê°ì§€
            function setupLocalStorageListener() {
                window.addEventListener('storage', function(e) {
                    if (e.key === 'pref-theme') {
                        setTimeout(updateGiscusTheme, 100);
                    }
                });
            }

            // í…Œë§ˆ ë³€ê²½ ê°ì§€ ë° ì¦‰ì‹œ ì ìš©
            function setupThemeSync() {
                // 1. body í´ë˜ìŠ¤ ë³€ê²½ ê°ì§€
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                            setTimeout(updateGiscusTheme, 50);
                        }
                    });
                });

                observer.observe(document.body, {
                    attributes: true,
                    attributeFilter: ['class']
                });

                // 2. í…Œë§ˆ í† ê¸€ ë²„íŠ¼ í´ë¦­ ê°ì§€
                const themeToggle = document.getElementById('theme-toggle');
                if (themeToggle) {
                    themeToggle.addEventListener('click', function() {
                        setTimeout(updateGiscusTheme, 100);
                    });
                }

                // 3. ì‹œìŠ¤í…œ í…Œë§ˆ ë³€ê²½ ê°ì§€
                if (window.matchMedia) {
                    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function() {
                        setTimeout(updateGiscusTheme, 100);
                    });
                }

                // 4. localStorage ë³€ê²½ ê°ì§€
                setupLocalStorageListener();

                // 5. í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° í…Œë§ˆ ì„¤ì •
                setTimeout(updateGiscusTheme, 500);
            }

            // Giscus ë¡œë“œ ì™„ë£Œ ê°ì§€ ë° í…Œë§ˆ ì„¤ì •
            function waitForGiscus() {
                const checkInterval = setInterval(function() {
                    const giscusFrame = document.querySelector('iframe[src*="giscus.app"]');
                    if (giscusFrame) {
                        clearInterval(checkInterval);
                        
                        // í…Œë§ˆ ë™ê¸°í™” ì„¤ì •
                        setupThemeSync();
                        
                        // ì´ˆê¸° í…Œë§ˆ ì ìš©
                        setTimeout(updateGiscusTheme, 100);
                    }
                }, 500);
            }

            // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
            document.addEventListener('DOMContentLoaded', function() {
                waitForGiscus();
            });
        </script>
    </div>
{{- end -}}

{{- /* Comments area end */ -}} 