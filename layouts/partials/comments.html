{{- /* Comments area start */ -}}
{{- /* to add comments read => https://gohugo.io/content-management/comments/ */ -}}

{{- if (and site.Params.comments (ne .Params.disableComments true)) -}}
    <div class="comments">
        <div class="comments-header">
            <h3>ğŸ’¬ ëŒ“ê¸€</h3>
        </div>

          <!-- Giscus ëŒ“ê¸€ ì‹œìŠ¤í…œ -->
  <script
          src="https://giscus.app/client.js"
          data-repo="dseung001/dseung001.github.io"
          data-repo-id="R_kgDOO9ggNQ"
          data-mapping="pathname"
          data-strict="0"
          data-reactions-enabled="1"
          data-emit-metadata="0"
          data-input-position="bottom"
          data-theme="light"
          data-lang="ko"
          crossorigin="anonymous"
          async>
  </script>
  
  <!-- í…Œë§ˆ ì „í™˜ ê°ì§€ë¥¼ ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    // ë‹¨ìˆœí™”ëœ í…Œë§ˆ ê°ì§€: body í´ë˜ìŠ¤ë§Œ í™•ì¸
    function getCurrentTheme() {
      return document.body.classList.contains('dark') ? 'dark' : 'light';
    }
    
    // Giscus í…Œë§ˆ ê°•ì œ ì—…ë°ì´íŠ¸
    function forceUpdateGiscusTheme() {
      const currentTheme = getCurrentTheme();
      const giscusScript = document.querySelector('script[src*="giscus.app"]');
      const giscusFrame = document.querySelector('iframe[src*="giscus.app"]');
      
      // ìŠ¤í¬ë¦½íŠ¸ í…Œë§ˆ ì†ì„± ì—…ë°ì´íŠ¸
      if (giscusScript) {
        giscusScript.setAttribute('data-theme', currentTheme);
      }
      
      // iframeì´ ë¡œë“œëœ ê²½ìš° ë©”ì‹œì§€ ì „ì†¡
      if (giscusFrame) {
        try {
          giscusFrame.contentWindow.postMessage({
            giscus: {
              setConfig: {
                theme: currentTheme
              }
            }
          }, 'https://giscus.app');
        } catch (error) {
          // Silent error handling
        }
      }
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ì„¤ì •
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(forceUpdateGiscusTheme, 500);
    });
  </script>

        <script>
            function checkGiscusStatus() {
                const giscusFrame = document.querySelector('iframe[src*="giscus.app"]');
                if (giscusFrame) {
                    alert('Giscus is loaded successfully!');
                } else {
                    alert('Giscus failed to load. Please check GitHub Discussions and Giscus app installation.');
                }
            }
            
            // í…Œë§ˆ ê°•ì œ ì„¤ì • í•¨ìˆ˜ (ë””ë²„ê¹…ìš©)
            function forceGiscusTheme(theme) {
                const giscusScript = document.querySelector('script[src*="giscus.app"]');
                const giscusFrame = document.querySelector('iframe[src*="giscus.app"]');
                
                if (giscusScript) {
                    giscusScript.setAttribute('data-theme', theme);
                }
                
                if (giscusFrame) {
                    try {
                        giscusFrame.contentWindow.postMessage({
                            giscus: {
                                setConfig: {
                                    theme: theme
                                }
                            }
                        }, 'https://giscus.app');
                    } catch (error) {
                        // Silent error handling
                    }
                }
                
                alert('Theme forced to: ' + theme);
            }
        </script>

        <!-- ëŒ“ê¸€ ë¡œë”© ì¤‘ í‘œì‹œ -->
        <div class="comments-loading" id="comments-loading">
            <p>comments loading...</p>
            <!-- ë””ë²„ê¹… ë²„íŠ¼ë“¤ -->
            <div style="margin-top: 15px; padding: 10px; background: var(--entry); border: 1px solid var(--border); border-radius: 5px;">
                <p style="font-size: 12px; color: var(--secondary); margin-bottom: 10px;">ğŸ”§ Debug Tools:</p>
                <button onclick="checkGiscusStatus()" style="margin-right: 10px; padding: 5px 10px; font-size: 12px;">Check Giscus Status</button>
                <button onclick="forceGiscusTheme('light')" style="margin-right: 10px; padding: 5px 10px; font-size: 12px; background: #007acc; color: white; border: none; border-radius: 3px;">Force Light Mode</button>
                <button onclick="forceGiscusTheme('dark')" style="margin-right: 10px; padding: 5px 10px; font-size: 12px; background: #333; color: white; border: none; border-radius: 3px;">Force Dark Mode</button>
                <button onclick="alert('HTML theme: ' + (document.documentElement.getAttribute('data-theme') || 'null') + '\nBody dark class: ' + document.body.classList.contains('dark') + '\nlocalStorage pref-theme: ' + (localStorage.getItem('pref-theme') || 'null'));" style="padding: 5px 10px; font-size: 12px;">Check Current Theme</button>
            </div>
        </div>

        <!-- Giscus ë¡œë”© ì™„ë£Œ ì‹œ ë¡œë”© ë©”ì‹œì§€ ìˆ¨ê¸°ê¸° ë° í…Œë§ˆ ì „í™˜ ê°ì§€ -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Giscusê°€ ë¡œë“œë˜ë©´ ë¡œë”© ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
                const checkGiscus = setInterval(function () {
                    const giscusFrame = document.querySelector('iframe[src*="giscus.app"]');
                    if (giscusFrame) {
                        document.getElementById('comments-loading').style.display = 'none';
                        clearInterval(checkGiscus);

                        // Giscus ë¡œë“œ í›„ í…Œë§ˆ ì„¤ì •
                        forceUpdateGiscusTheme();
                    }
                }, 1000);

                // 10ì´ˆ í›„ì—ë„ ë¡œë“œë˜ì§€ ì•Šìœ¼ë©´ ë©”ì‹œì§€ ë³€ê²½
                setTimeout(function () {
                    const loadingElement = document.getElementById('comments-loading');
                    if (loadingElement && loadingElement.style.display !== 'none') {
                        loadingElement.innerHTML = `
            <p>ëŒ“ê¸€ ë¡œë”©ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.</p>
            <p style="font-size: 12px; color: var(--secondary); margin-top: 10px;">
              <a href="https://github.com/dseung001/dseung001.github.io/discussions" target="_blank">GitHub Discussionsì—ì„œ ëŒ“ê¸€ì„ í™•ì¸í•˜ì„¸ìš”</a>
            </p>
          `;
                    }
                }, 10000);
            });

            

            

                // ì‹œìŠ¤í…œ í…Œë§ˆ ë³€ê²½ ê°ì§€
    if (window.matchMedia) {
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function (e) {
        forceUpdateGiscusTheme();
      });
    }
    
    // í…Œë§ˆ í† ê¸€ ë²„íŠ¼ í´ë¦­ ê°ì§€
    function detectThemeToggle() {
      const themeToggle = document.getElementById('theme-toggle');
      if (themeToggle) {
        themeToggle.addEventListener('click', function() {
          // í…Œë§ˆ ì „í™˜ í›„ ì¦‰ì‹œ Giscus ì—…ë°ì´íŠ¸
          setTimeout(forceUpdateGiscusTheme, 100);
        });
      }
    }
    
    // body í´ë˜ìŠ¤ ë³€ê²½ ê°ì§€
    function setupBodyClassObserver() {
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
            // ì¦‰ì‹œ í…Œë§ˆ ì—…ë°ì´íŠ¸
            forceUpdateGiscusTheme();
          }
        });
      });
      
      const bodyElement = document.body;
      observer.observe(bodyElement, {
        attributes: true,
        attributeFilter: ['class']
      });
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ê°ì§€ ì„¤ì •
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(detectThemeToggle, 1000);
      setTimeout(setupBodyClassObserver, 1000);
    });
        </script>
    </div>
{{- end -}}

{{- /* Comments area end */ -}} 